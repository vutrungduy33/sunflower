# TC-M1-12 现场验收打勾单（订单中心改期/退款）

> 版本：v1  
> 适用里程碑：M1（S1-S6）  
> 适用环境：微信开发者工具 + `sunflower-backend` 可用环境

## 1. 执行信息

- 执行人：`______`
- 执行日期：`______`
- 环境（dev/test/prod-like）：`______`
- 小程序版本/分支：`______`
- 后端版本/分支：`______`

## 2. 前置条件检查

- [ ] C1 已能打开小程序并进入首页
- [ ] C2 当前账号已完成登录（可访问“订单中心”）
- [ ] C3 存在至少 1 条 `CONFIRMED` 或 `RESCHEDULED` 订单
- [ ] C4 后端接口可访问（`GET /api/health` 返回成功）

若 C3 不满足，先执行一次快速造数（下单并支付），再继续本单。

## 3. 证据存放规范

- 建议目录：`docs/test-evidence/m1/tc-m1-12/`
- 截图命名：`01-xxx.png`、`02-xxx.png`（与步骤编号对应）
- 若有录屏：`tc-m1-12-flow.mp4`

## 4. 步骤清单（逐步打勾）

### A. 进入订单中心

- [ ] S1 打开“我的”页并进入“订单中心”
  - 预期：页面加载成功，显示订单列表或空态，不白屏
  - 证据：`01-order-list-entry.png`

- [ ] S2 在目标订单卡片上确认可见“改期”“申请退款”按钮（状态应为 `CONFIRMED` 或 `RESCHEDULED`）
  - 预期：按钮可见且可点击
  - 证据：`02-order-actions-visible.png`

### B. 改期流程

- [ ] S3 点击“改期”，在弹窗中选择“顺延 1 天/2 天/3 天”任一项
  - 预期：弹窗可正常弹出并可选择
  - 证据：`03-reschedule-sheet.png`

- [ ] S4 提交后观察提示与列表刷新
  - 预期：出现“改期成功”提示；订单状态更新为“已改期”；入住/离店日期发生对应顺延
  - 证据：`04-reschedule-success.png`

- [ ] S5 切换筛选到“已改期”
  - 预期：能筛出刚改期的订单，状态标签显示正确
  - 证据：`05-filter-rescheduled.png`

### C. 退款流程

- [ ] S6 在已改期（或待入住）订单点击“申请退款”，在确认弹窗点击“确认退款”
  - 预期：确认弹窗可正常交互
  - 证据：`06-refund-confirm.png`

- [ ] S7 提交后观察提示与列表刷新
  - 预期：出现“退款成功”提示；订单状态更新为“已退款”
  - 证据：`07-refund-success.png`

- [ ] S8 切换筛选到“已退款”
  - 预期：能筛出刚退款的订单，状态标签显示正确
  - 证据：`08-filter-refunded.png`

### D. 接口字段抽查（建议）

- [ ] S9 调用 `GET /api/orders/{id}`（取本次测试订单）
  - 预期：返回包含 `status=REFUNDED`，且 `rescheduledAt/refundedAt/afterSaleReason` 字段符合预期
  - 证据：`09-order-detail-api.png`

### E. 首页重进稳定性（本次修复验证）

- [ ] S10 返回首页后再次进入“订单中心”
  - 预期：不会因首页重登切换用户，原订单列表仍可见
  - 证据：`10-home-reenter-order-stable.png`

## 5. 异常观察（可选）

- [ ] E1 操作期间无明显 UI 卡死、重复提交、无提示失败
- [ ] E2 若失败，已记录错误文案、时间点、订单 ID、截图

## 6. 结果判定

- [ ] 通过（所有 S1-S8 与 S10 必选步骤通过）
- [ ] 不通过（存在必选步骤失败）

失败说明（必填）：  
`______`

缺陷记录链接（如有）：  
`______`

## 7. 回归建议

1. 每次后端订单状态机相关改动后，至少回放一次本清单。  
2. 发版前在 prod-like 环境执行一次完整录屏回放。  
3. 与 `docs/M1-Integration-Test-Plan.md` 中 `TC-M1-12` 保持同步更新。
