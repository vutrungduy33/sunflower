<view class="mvp-page">
  <view class="mvp-state mvp-state--loading" wx:if="{{loading}}">正在加载个人信息...</view>

  <view class="mvp-state" wx:if="{{!loading && errorMessage}}">
    <view class="mvp-state__title">个人页加载失败</view>
    <view class="mvp-state__desc">{{errorMessage}}</view>
    <view class="mvp-state__action">
      <t-button size="small" theme="primary" bindtap="retryLoadData">重新加载</t-button>
    </view>
  </view>

  <block wx:if="{{!loading && !errorMessage && profile}}">
    <view class="mvp-section profile-card">
      <view class="avatar">葵</view>
      <view class="profile-main">
        <view class="profile-name">{{profile.nickName}}</view>
        <view class="profile-phone">{{profile.isPhoneBound ? profile.phone : '未绑定手机号'}} · {{tagsText}}</view>
      </view>
      <t-button size="small" theme="primary" variant="outline" bindtap="goOrderList">订单中心</t-button>
    </view>

    <view class="mvp-section">
      <view class="mvp-section__title">订单概览</view>
      <view class="stats-grid">
        <view class="stats-item">
          <view class="stats-item__value">{{orderStats.pending}}</view>
          <view class="stats-item__label">待支付</view>
        </view>
        <view class="stats-item">
          <view class="stats-item__value">{{orderStats.confirmed}}</view>
          <view class="stats-item__label">待入住</view>
        </view>
        <view class="stats-item">
          <view class="stats-item__value">{{orderStats.completed}}</view>
          <view class="stats-item__label">已完成</view>
        </view>
      </view>
    </view>

    <view class="mvp-section">
      <view class="mvp-section__title">基础资料</view>
      <view class="field">
        <text class="field-label">昵称</text>
        <input class="field-input" value="{{editingNickName}}" data-field="editingNickName" bindinput="onInput" />
      </view>
      <t-button size="small" theme="primary" variant="outline" bindtap="saveNickname">保存昵称</t-button>

      <view class="field mt16">
        <text class="field-label">手机号绑定（MVP 一期）</text>
        <input
          class="field-input"
          type="number"
          maxlength="11"
          value="{{bindingPhone}}"
          placeholder="请输入 11 位手机号"
          data-field="bindingPhone"
          bindinput="onInput"
        />
      </view>
      <t-button size="small" theme="primary" bindtap="bindPhone">绑定手机号</t-button>
    </view>

    <view class="mvp-section">
      <view class="mvp-section__title">客服与帮助</view>
      <view class="mvp-muted">前台电话：188-0000-1234</view>
      <view class="mvp-muted mt8">微信客服：sunflower-lugu</view>
      <t-button class="mt16" size="small" theme="default" variant="outline" bindtap="goBooking">继续预订</t-button>
    </view>
  </block>

  <view class="mvp-empty" wx:if="{{!loading && !errorMessage && !profile}}">暂无个人信息，请稍后重试。</view>
</view>

<mvp-tabbar current="mine" />
